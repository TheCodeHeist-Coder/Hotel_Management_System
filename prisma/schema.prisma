generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         String    @unique @default(uuid())
  name       String
  email      String    @unique
  password   String
  role       Role @default(user)
  phone      String?
  created_at DateTime  @default(now())
  hotels     Hotel[]
  bookings   Booking[]
  reviews    Review[]
}

model Hotel {
  id            String   @id @default(uuid())
  ownerId       String
  name          String
  description   String
  city          String
  country       String
  amenities     String[]
  ratings       Decimal  @default(0.0) @db.Decimal(2, 1)
  totalReviews Int      @default(0) @map("total_reviews")

  user User @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  created_at DateTime  @default(now())
  rooms      Room[]
  bookings   Booking[]
  reviews    Review[]
}

model Room {
  id            String   @id @default(uuid())
  hotelId       String
  roomNumber    String   @map("room_number") @db.VarChar(50)
  roomType      String   @map("room_type") @db.VarChar(100)
  pricePerNight Decimal  @map("price_per_night") @db.Decimal(10, 2)
  maxOccupancy  Int      @map("max_occupancy")
  created_at    DateTime @default(now())

  hotel    Hotel     @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@unique([hotelId, roomNumber])
}

model Booking {
  id            String       @id @default(uuid())
  userId        String
  roomId        String
  hotelId       String
  checkInDate   DateTime     @map("check_in_date") @db.Date //? Stores only dates not time
  checkOutDate  DateTime     @map("check_out_date") @db.Date
  guests        Int
  totalPrice   Decimal      @db.Decimal(10, 2) @map("total_price")
  status        BookinStatus @default(confirmed)
  bookingDate   DateTime     @default(now()) @map("booking_date")
  cancelledDate DateTime?    @map("cancelled_at")

  user    User     @relation(fields: [userId], references: [id])
  hotel   Hotel    @relation(fields: [hotelId], references: [id])
  room    Room     @relation(fields: [roomId], references: [id])
  reviews Review[]
}

model Review {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  hotelId    String   @map("hotel_id")
  bookingId  String   @map("booking_id")
  rating     Int
  comment    String
  created_at DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  hotel   Hotel   @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@unique([userId, bookingId])
}

enum Role {
  user
  owner
}

enum BookinStatus {
  confirmed
  cancelled
}

//! Note :-

//  roomNumber    String   @db.VarChar(50)   @map("room_number")

//? -> it means `roomNumber` in development preffered by developers but snake-case in db
